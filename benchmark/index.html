<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		@import url('https://fonts.googleapis.com/css2?family=Noto Sans JP:wght@900&display=swap');

		html, body {
			height: 100%;
			margin: 0;
		}
		body {
			background: white;
			font-family: 'Noto Sans JP', sans-serif;
		}
	</style>
	<!--<link rel="stylesheet" href="../theme/dark.css">-->
	<link rel="stylesheet" href="highlight/styles/atom-one-dark.min.css">
	<link rel="stylesheet" href="prism/prism.css">
	<head>
<body>
	<div></div>
	<script src="prism/prism.js"></script>
	<script src="highlight/highlight.js"></script>
	<script src="highlight/languages/javascript.min.js"></script>
	<script type="module">
		import * as SHG from '../index.js';
		SHG.setTheme('../themes/default.css');

		const tests = [
			`\`\${e => {{{{{{{{{{{{{{}}}}}}}}}}}}}}test test bre\` str
\`\${e => {{{{{{{{{{{{{{}}}}}}}}}}}}}}test test bre}\` str`,
			`\`\${e => {{{{{{{{{{{{{let i = 5}}}}}}}}}}}}}test}\${test}test\`
const HTML = 'html'
e => console.log(e);
'str'
str
"st\\r"
str
Math.random();
\`\${e => {}}test\`
\`\${}test\`
"st\\" str "str\\" str
str
"str\\"
str/*
str`,
`const listener = Deno.listen({ port: 8000 });
console.log("http://localhost:8000/");
for await (const conn of listener) {
  (async () => {
    const requests = Deno.serveHttp(conn);
    for await (const { respondWith } of requests) {
      respondWith(new Response("Hello world"));
    }
  })();
}`,
`"use strict'test
"test' test
test`,
	`#jsx
function test() {
	return <div class="\${css}"></div>
}`,
			`#!/path-to-v8/v8-shell
const heart = new Image(),
	love = document.querySelector('#love');
let confetti;

heart.onload = () => {
	confetti = new Confetti();
	confetti.canvas.style.zIndex = -1;
	confetti.count = 25;
	confetti.setImage(heart, 20, 20);
}

heart.src = 'heart.png';
love.addEventListener('click', e => {
	if (love.classList.toggle('love'))
		confetti?.startAt?.(e.clientX, e.clientY);
});`,
			`//this is a giant comment that take more than an entire line / page so that mean that is rogthoi zeoifzeoinbfozei foez foiezfoi zeoif zeoif oez foizenfoi nzeoi foizefizefonzeoif zeofinzeoifnzoie fzef oizefoizenfion zefi ezoinf oieznfoinezfoin ez f`,
			`//create a instance of the class
const confetti = new Confetti('demo');
hello
/*
setting properties
*/
test 	?. 	()
/* test */*
test 	?. 	()
'test' + hello + 'test';
cconst ;
Nan;
NaN;
NaN_;
NaN1;
_NaN;
true ;
undefined ;
'hel
lo';
"h\\nello";
\`he\nel
\${str}
o\\\${js}heel
o\${let i = 5; error()}\`;
ï¿½class
js.if ;
9e5;
9e5.8e9;
9.8e5.8e9;
9.e5.8e9;
e9.e5.8e9;
e9.e5.8e9e;
e9.e5.8e9.;
test?v1:v2;
\`str\`
vall ==== col
function helloworld()
{
	console.log('hellow world');
	return (false);
}
class Renderer
{
	constructor(v, h)
	{
		super();
		console.log(hello);
		this.v = v;
	}
	get error()
	{
		console.log(error)
	}
}
/regex/g
/([abc]str|e)(\\/{1,5}|\\2)*.+$/
9.5;
let func = () => ();
let func = function(){};
func 	();
js.catch() ;
elm.5;
elm[5];
elm['5'];
elm[5]();
window;
document;
Array;
confetti.count
=
75;
confetti.size = 1;
confetti.power = 25;
confetti.removeFunc = elm => {
	elm.style.visibility = 'hidden';
	elm.style.opacity = 0;
	setTimeout(e => {
		elm.style.visibility = null;
		elm.style.opacity = 1;
	}, 5000);
};`,
`}
somecode();
console.log('helloworld');`,
			new Promise((resolve, reject) => fetch('prism/prism.js').then(res => res.text().then(txt => resolve(txt)).catch(err => reject(err))).catch(err => reject(err)))
		]

		async function mesureCallTime(func, ...params)
		{
			let before = performance.now();
			await func(...params);
			return performance.now() - before;
		}

		function createCodeElm(str, className, parent, data)
		{
			let pre = document.createElement('pre'),
				code = document.createElement('code');
			pre.className = className;
			code.innerHTML = str.replaceAll('<', '&lt;').replaceAll('>', '&gt;');
			code.dataset.language = data;
			pre.appendChild(code);
			parent.appendChild(pre);
			return { pre, code };
		}

		const parent = document.querySelector('body > div');
		Promise.all(tests).then(async codes => 
		{
			for (let i in codes) {
				const code = codes[i];

				const shgTime = await mesureCallTime(SHG.highlightElement, createCodeElm(code, 'lang-js', parent).code);
				const prismTime = await mesureCallTime(Prism.highlightElement, createCodeElm(code, 'language-js prism', parent).code);
				const highlightTime = await mesureCallTime(hljs.highlightElement, createCodeElm(code, 'language-javascript highlight', parent).code);

				const data = [[shgTime, 'shg (our)'], [prismTime, 'prism'], [highlightTime, 'highlight.js']];
				const sorted = data.sort((a, b) => a[0] - b[0]);

				console.groupCollapsed(`best: ${sorted[0][1]} ${sorted[0][0]}ms (${sorted.at(-1)[0] / sorted[0][0]}x better then the worst, ${shgTime / sorted[0][0]}x better than us)`);
				for (let hlt of data)
					console.log(`${hlt[1]} ${hlt[0]}ms`);
				console.groupEnd();
			}
		}).catch(err => console.log(err));
	</script>
</body>
</html>
