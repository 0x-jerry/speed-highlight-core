import expandData from"./common.js";const langs={},sanitize=(t="")=>t.replaceAll("&","&#38;").replaceAll?.("<","&lt;").replaceAll?.(">","&gt;"),toSpan=(t,l)=>l?`<span class="sh-syn-${l}">${t}</span>`:t;async function highlightText(t,l,e=!0){let a,n,i=e?`<div><div class="sh-numbers">${"<div></div>".repeat(t.split("\n").length)}</div><div>`:"",s=[],h,g,c,d,p,o,m=0,r="string"==typeof l?await(langs[l]??=import(`./languages/${l}.js`)):{};"string"==typeof l&&(l=[...r.default]);const x=(t,l)=>((t,l)=>i+=toSpan(t,l))(sanitize(t),l);for(;m<t.length;){for(d=null,a=l.length;0<=--a;){if(n=l[a].expand?expandData[l[a].expand]:l[a],void 0===s[a]||s[a].match.index<m){if(n.match.lastIndex=m,g=n.match.exec(t),null===g){l.splice(a,1),s.splice(a,1);continue}s[a]={match:g,lastIndex:n.match.lastIndex}}h=s[a].match.index,g=s[a].match[0],g&&(h<=d||null===d)&&(c=n,d=h,o=g,p=s[a].lastIndex)}if(null===d)break;x(t.slice(m,d),r.type),m=p,c.sub?i+=await highlightText(o,c.sub,!1):x(o,c.type)}return x(t.slice(m,t.length),r.type),e&&(i+="</div></div>"),i}async function highlightElement(t,l=t.className.match(/sh-lang-([\w-]+)/)?.[1],e="CODE"!=t.tagName){t.dataset.lang=l,t.classList.add("sh-lang-"+l),t.innerHTML=await highlightText(t.textContent,l,e)}let highlightAll=async()=>document.querySelectorAll('[class*="sh-lang-"]').forEach(t=>highlightElement(t));export{highlightText,highlightElement,highlightAll};