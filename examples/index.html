<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Languages | Speed highlight JS</title>
	<link rel="stylesheet" href="./style.css">
</head>
<body>
	<script type="module">
		import { highlightElement } from '../src/index.js';
		import Radio from './helper/radio.js';
		import { themes, testFiles } from './helper/data.js';

		const code = document.createElement('div');

		function updateTextContent(elm, content) {
			elm.textContent = content;
			elm.animate(
				[
					{ background: '#25f3' },
					{ background: 'unset' }
				],
				{ duration: 150 }
			);
		}

		function	loadExample(language = 'js') {
			let path = language.split('.').length === 1 ? `test.${language}` : language;
			fetch(`./languages/${path}`)
				.then(res => res.text()
					.then(async txt => {
						code.textContent = txt;
						let before = performance.now();
						await highlightElement(code, language.split('.')[1] || language);
						updateTextContent(chrono, `${(performance.now() - before).toFixed(3)}ms (counting loading time)`);
					})
					.catch(err => console.log(err))
				).catch(err => console.log(err));
		}

		const radioTheme = new Radio('theme', themes, document.body),
			themeElm = document.createElement('link');
		themeElm.rel = 'stylesheet';
		themeElm.type = 'text/css';
		document.head.appendChild(themeElm);
		radioTheme.onchange(theme => themeElm.href = `../src/themes/${theme}.css`);

		const radioMode = new Radio('mode', ['none', 'noheader mode', 'window mode'], document.body);
		radioMode.onchange(mode => code.className = `${[...code.classList].filter(s => !s.startsWith('shj-mode-')).join(' ')}${mode == none ? '' : ' shj-mode-' + mode.split(' ')[0]}`);

		const radioTestFiles = new Radio('language', testFiles, document.body),
			chrono = document.createElement('span');
		radioTestFiles.onchange(loadExample);
		chrono.className = 'chrono';
		document.body.appendChild(chrono);
		document.body.appendChild(code);
	</script>
</body>
</html>
