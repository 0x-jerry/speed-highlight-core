<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Languages | Speed highlight JS</title>
	<link rel="stylesheet" href="./style.css">
</head>
<body>
	<script type="module">
		import { highlightElement } from '../src/index.js'
		import { detectLanguage } from '../src/detect.js'
		import { elm, Radio, Checkbox } from './helper/elm.js'
		import { themes, testFiles } from './helper/data.js'

		let code = elm('div'),
			detect = false;

		async function	highlight(language) {
			let path = language.split('.').length === 1 ? `test.${language}` : language,
				res = await fetch(`./languages/${path}`),
				txt = await res.text()
			code.textContent = txt
			let before = performance.now()
			await highlightElement(code, detect ? detectLanguage(txt) : language.split('.')[1] || language)
			chrono.textContent = `${(performance.now() - before).toFixed(3)}ms (counting loading time)`
			chrono.animate([
					{ background: '#25f3' },
					{ background: 'unset' }
				],{ duration: 150 })
		}

		let stylesheet = elm('link', { rel: 'stylesheet', type: 'text/css' }, document.head)

		new Radio('theme', theme => stylesheet.href = `../src/themes/${theme}.css`, themes)
			
		new Radio('mode', 
			mode => code.className = [...code.classList].filter(s => !s.startsWith('shj-mode-')).join(' ')
				+ (mode == 'none' ? '' : ' shj-mode-' + mode.split(' ')[0])
		,['none', 'header mode'])

		let lang = new Radio('language', lang => highlight(lang, detect), testFiles),
			container = elm('div', { className: 'radio-list' })
		new Checkbox('detect', 'detect language', on => {
			detect = on
			highlight(lang.selected)
		}, container)
		let chrono = elm('span', { className: 'chrono' })

		document.body.appendChild(code)
	</script>
</body>
</html>
